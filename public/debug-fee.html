<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>íšŒë¹„ ê¸°ëŠ¥ ë””ë²„ê·¸</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #f0f0f0; }
        .test-box { background: white; padding: 20px; margin: 10px 0; border-radius: 8px; }
        .success { color: green; font-weight: bold; }
        .error { color: red; font-weight: bold; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
        #log { background: #000; color: #0f0; padding: 10px; font-family: monospace; max-height: 400px; overflow-y: auto; }
    </style>
</head>
<body>
    <h1>ğŸ” íšŒë¹„ ê¸°ëŠ¥ ë””ë²„ê·¸ í…ŒìŠ¤íŠ¸</h1>
    
    <div class="test-box">
        <h2>1. ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ í™•ì¸</h2>
        <div id="script-check">í™•ì¸ ì¤‘...</div>
    </div>
    
    <div class="test-box">
        <h2>2. ì „ì—­ í•¨ìˆ˜ ì¡´ì¬ í™•ì¸</h2>
        <div id="function-check">í™•ì¸ ì¤‘...</div>
    </div>
    
    <div class="test-box">
        <h2>3. ë²„íŠ¼ í…ŒìŠ¤íŠ¸</h2>
        <button onclick="testShowFeeSettingModal()">íšŒë¹„ ì„¤ì • ëª¨ë‹¬ ì—´ê¸°</button>
        <button onclick="testShowPayFeeModal()">ë‚©ë¶€ ë“±ë¡ ëª¨ë‹¬ ì—´ê¸°</button>
        <button onclick="testSendUnpaidSMS()">ë¯¸ë‚©ì ë¬¸ì ë°œì†¡</button>
    </div>
    
    <div class="test-box">
        <h2>4. ì½˜ì†” ë¡œê·¸</h2>
        <div id="log"></div>
    </div>
    
    <!-- modalContainer -->
    <div id="modalContainer"></div>
    
    <!-- ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ (ì‹¤ì œ ì•±ê³¼ ë™ì¼í•œ ìˆœì„œ) -->
    <script src="https://cdn.jsdelivr.net/npm/axios@1.6.0/dist/axios.min.js"></script>
    <script src="/static/fee-functions.js"></script>
    
    <script>
        // ë¡œê·¸ í•¨ìˆ˜
        function log(message, isError = false) {
            const logDiv = document.getElementById('log');
            const time = new Date().toLocaleTimeString();
            const color = isError ? '#f00' : '#0f0';
            logDiv.innerHTML += `<div style="color: ${color}">[${time}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(message);
        }
        
        // ì´ˆê¸°í™”
        window.app = {
            data: {
                feeSetting: { year: 2026, amount: 50000, description: '2026ë…„ ì—°íšŒë¹„' },
                members: [
                    { id: 1, name: 'í…ŒìŠ¤íŠ¸1', club: 'ë¶€ë¦¼' },
                    { id: 2, name: 'í…ŒìŠ¤íŠ¸2', club: 'ì¸ë•ì›' }
                ],
                feeStats: {
                    unpaidMembers: [
                        { id: 3, name: 'ë¯¸ë‚©ì1', phone: '010-1234-5678' }
                    ]
                }
            }
        };
        
        window.closeModal = function() {
            document.getElementById('modalContainer').innerHTML = '';
            document.getElementById('modalContainer').style.display = 'none';
            log('âœ… ëª¨ë‹¬ ë‹«ê¸° ì‹¤í–‰ë¨');
        };
        
        // 1. ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ í™•ì¸
        setTimeout(() => {
            const scriptCheck = document.getElementById('script-check');
            const scripts = Array.from(document.querySelectorAll('script')).map(s => s.src);
            const hasFeeScript = scripts.some(s => s.includes('fee-functions.js'));
            
            if (hasFeeScript) {
                scriptCheck.innerHTML = '<span class="success">âœ… fee-functions.js ë¡œë“œë¨</span>';
                scriptCheck.innerHTML += '<br>' + scripts.filter(s => s.includes('fee')).join('<br>');
                log('âœ… fee-functions.js ìŠ¤í¬ë¦½íŠ¸ íƒœê·¸ ë°œê²¬');
            } else {
                scriptCheck.innerHTML = '<span class="error">âŒ fee-functions.js ì—†ìŒ</span>';
                log('âŒ fee-functions.js ìŠ¤í¬ë¦½íŠ¸ íƒœê·¸ ì—†ìŒ', true);
            }
        }, 100);
        
        // 2. í•¨ìˆ˜ ì¡´ì¬ í™•ì¸
        setTimeout(() => {
            const functionCheck = document.getElementById('function-check');
            const functions = {
                'window.showFeeSettingModal': typeof window.showFeeSettingModal,
                'window.showPayFeeModal': typeof window.showPayFeeModal,
                'window.processFeePayment': typeof window.processFeePayment,
                'window.saveFeeSetting': typeof window.saveFeeSetting,
                'window.deleteFeePayment': typeof window.deleteFeePayment,
                'window.sendUnpaidSMS': typeof window.sendUnpaidSMS,
                'window.payFeeForMember': typeof window.payFeeForMember
            };
            
            let html = '';
            let allOk = true;
            for (const [name, type] of Object.entries(functions)) {
                const isOk = type === 'function';
                allOk = allOk && isOk;
                const className = isOk ? 'success' : 'error';
                const icon = isOk ? 'âœ…' : 'âŒ';
                html += `<div class="${className}">${icon} ${name}: ${type}</div>`;
                log(`${icon} ${name}: ${type}`, !isOk);
            }
            functionCheck.innerHTML = html;
            
            if (allOk) {
                log('âœ… ëª¨ë“  í•¨ìˆ˜ê°€ ì •ìƒì ìœ¼ë¡œ ë“±ë¡ë¨');
            } else {
                log('âŒ ì¼ë¶€ í•¨ìˆ˜ê°€ ë“±ë¡ë˜ì§€ ì•ŠìŒ', true);
            }
        }, 200);
        
        // 3. í…ŒìŠ¤íŠ¸ í•¨ìˆ˜ë“¤
        function testShowFeeSettingModal() {
            log('ğŸ”µ íšŒë¹„ ì„¤ì • ëª¨ë‹¬ í…ŒìŠ¤íŠ¸ ì‹œì‘');
            try {
                if (typeof window.showFeeSettingModal === 'function') {
                    window.showFeeSettingModal();
                    log('âœ… íšŒë¹„ ì„¤ì • ëª¨ë‹¬ í˜¸ì¶œ ì„±ê³µ');
                    
                    setTimeout(() => {
                        const modal = document.getElementById('modalContainer');
                        if (modal && modal.innerHTML.includes('íšŒë¹„ ì„¤ì •')) {
                            log('âœ… ëª¨ë‹¬ HTML ìƒì„± í™•ì¸');
                        } else {
                            log('âŒ ëª¨ë‹¬ HTMLì´ ìƒì„±ë˜ì§€ ì•ŠìŒ', true);
                        }
                    }, 100);
                } else {
                    log('âŒ window.showFeeSettingModalì´ í•¨ìˆ˜ê°€ ì•„ë‹˜', true);
                }
            } catch (error) {
                log('âŒ ì˜¤ë¥˜: ' + error.message, true);
            }
        }
        
        function testShowPayFeeModal() {
            log('ğŸ”µ ë‚©ë¶€ ë“±ë¡ ëª¨ë‹¬ í…ŒìŠ¤íŠ¸ ì‹œì‘');
            try {
                if (typeof window.showPayFeeModal === 'function') {
                    window.showPayFeeModal();
                    log('âœ… ë‚©ë¶€ ë“±ë¡ ëª¨ë‹¬ í˜¸ì¶œ ì„±ê³µ');
                    
                    setTimeout(() => {
                        const modal = document.getElementById('modalContainer');
                        if (modal && modal.innerHTML.includes('íšŒë¹„ ë‚©ë¶€')) {
                            log('âœ… ëª¨ë‹¬ HTML ìƒì„± í™•ì¸');
                        } else {
                            log('âŒ ëª¨ë‹¬ HTMLì´ ìƒì„±ë˜ì§€ ì•ŠìŒ', true);
                        }
                    }, 100);
                } else {
                    log('âŒ window.showPayFeeModalì´ í•¨ìˆ˜ê°€ ì•„ë‹˜', true);
                }
            } catch (error) {
                log('âŒ ì˜¤ë¥˜: ' + error.message, true);
            }
        }
        
        function testSendUnpaidSMS() {
            log('ğŸ”µ ë¯¸ë‚©ì ë¬¸ì ë°œì†¡ í…ŒìŠ¤íŠ¸ ì‹œì‘');
            try {
                if (typeof window.sendUnpaidSMS === 'function') {
                    window.sendUnpaidSMS();
                    log('âœ… ë¯¸ë‚©ì ë¬¸ì ë°œì†¡ í˜¸ì¶œ ì„±ê³µ');
                } else {
                    log('âŒ window.sendUnpaidSMSì´ í•¨ìˆ˜ê°€ ì•„ë‹˜', true);
                }
            } catch (error) {
                log('âŒ ì˜¤ë¥˜: ' + error.message, true);
            }
        }
        
        log('ğŸš€ ë””ë²„ê·¸ í˜ì´ì§€ ì´ˆê¸°í™” ì™„ë£Œ');
    </script>
</body>
</html>
